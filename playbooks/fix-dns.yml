---
# One-time fix: set DNS on nodes so they can resolve (e.g. mirrors.rockylinux.org).
# Override dns_nameservers in group_vars if you use internal DNS.
- hosts: k8s
  become: true
  vars:
    # Override in group_vars (e.g. your router or internal DNS)
    dns_nameservers: "{{ dns_nameservers | default(['8.8.8.8', '8.8.4.4']) }}"
  tasks:
    - name: Set DNS nameservers in /etc/resolv.conf
      copy:
        dest: /etc/resolv.conf
        content: |
          # Managed by Ansible (playbooks/fix-dns.yml)
          {% for ns in dns_nameservers %}
          nameserver {{ ns }}
          {% endfor %}
        force: true
