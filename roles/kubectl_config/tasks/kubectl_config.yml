---
# Read kubeconfig from first master (with become) and write to control host.
# Uses slurp on the master so path /root/.kube/config is read as root; no temp files on master.

- name: Read kubeconfig from first master (become to read root-only file)
  slurp:
    src: "{{ kubectl_config_src }}"
  delegate_to: "{{ kubectl_first_master }}"
  become: true
  register: kubeconfig_slurp
  run_once: true
  tags: [kubectl_config]

- name: Write kubeconfig to control host
  copy:
    content: "{{ kubeconfig_slurp.content | b64decode }}"
    dest: "{{ kubectl_config_dest }}"
    mode: "0600"
  run_once: true
  tags: [kubectl_config]
