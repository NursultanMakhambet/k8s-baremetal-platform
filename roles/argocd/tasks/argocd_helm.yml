---
# Argo CD: install via Helm. Run on localhost with helm, KUBECONFIG set.
# Only runs when platform_install_argocd is true (driven by is_ArgoCD_included or platform_install_argocd in group_vars).

- name: Add Argo CD Helm repo
  shell: helm repo add argo https://argoproj.github.io/argo-helm
  changed_when: true
  run_once: true
  when: platform_install_argocd | default(false) | bool
  tags: [argocd]

- name: Update Helm repos
  shell: helm repo update
  run_once: true
  when: platform_install_argocd | default(false) | bool
  tags: [argocd]

- name: Install Argo CD in argocd namespace
  shell: >
    helm upgrade --install argocd argo/argo-cd
    --namespace argocd
    --create-namespace
    --wait
  run_once: true
  when: platform_install_argocd | default(false) | bool
  tags: [argocd]
